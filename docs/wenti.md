
### **项目核心问题修复与重构计划**

#### **第一阶段：清理环境与统一标准**

这个阶段的目标是消除混乱，让项目环境变得一致和可预测。

1.  **统一服务管理工具**：
    * **确定唯一入口**：将 `unified_service_manager.py` 作为唯一的后端服务管理工具。
    * **修改启动脚本**：更新根目录下的 `manage.bat`，使其所有命令（`start`, `stop`, `status`）都指向 `unified_service_manager.py`。
    * **删除冗余文件**：安全删除 `service_manager.py`, `service_gui.py`, `service_console.py` 以及相关的 `.bat` 启动脚本，避免混淆。

2.  **统一端口配置**：
    * **修正后端端口**：在 `backend/app/main.py` 中，将启动参数帮助信息里的默认端口从 “5317” 修改为 “5318”，确保代码、文档和实际行为三者一致。

#### **第二阶段：重建文档与修复关键功能**

此阶段的重点是恢复项目的可维护性，并解决最关键的功能障碍——数据下载。

3.  **修复数据下载功能 (高优先级)**：
    * **解除硬编码**：修改 `backend/app/services/data_downloader.py`，移除固定的股票列表。使其核心下载函数能够接收一个包含多个股票代码（tickers）的列表作为参数。
    * **升级API接口**：修改 `backend/app/api/data.py` 中的下载接口。使其能够通过 POST 请求接收一个包含 `tickers` 列表、`start_date` 和 `end_date` 的JSON对象，从而实现让用户可以动态请求、下载任意股票数据。

4.  **建立透明的文档体系**：
    * **创建状态快照**：在 `docs/` 目录下新建一个 `current_system_status.md` 文件。用它来清晰地记录当前项目的真实进展、已知问题和下一步计划。
    * **更新项目门面**：修改根目录的 `README.md`，移除过时或不准确的描述（如“自动下载全市场数据”）。更新“开发状态”部分，并链接到新建的 `current_system_status.md`，让所有人都能快速了解项目现状。

#### **第三阶段：搭建未来开发的框架**

这个阶段是为后续的核心功能开发铺路，确保代码结构清晰、质量可控。

5.  **搭建后端测试框架**：
    * **创建测试目录**：在 `backend/` 目录下创建一个 `tests/` 文件夹。
    * **加入基础配置**：在 `tests/` 目录中添加一个简单的 `pytest.ini` 配置文件和一个基础的测试文件（例如 `test_health.py`），用于测试 `/api/v1/health` 接口能否正常工作。这标志着项目质量保障体系的开始。

6.  **重构回测引擎为框架**：
    * **定义核心结构**：修改 `backend/app/engine/backtest_engine.py`。将其重构为一个 `BacktestEngine` 类。
    * **预留核心方法**：在该类中，定义好未来需要实现的核心方法框架，如 `_prepare_data` (数据准备), `_execute_strategy` (策略执行), `_calculate_metrics` (性能计算) 和一个统一的 `run` 方法来调用它们。暂时无需实现内部复杂逻辑，只需搭建好骨架。

