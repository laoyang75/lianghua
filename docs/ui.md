# 量化回测系统操作手册

## 一、系统概述

本系统是一个专业的量化策略回测平台，通过历史数据验证交易策略的有效性。系统采用"数据准备→标签计算→策略配置→回测执行→结果分析"的标准化流程。

## 二、核心概念说明

### 2.1 数据标签
**数据标签**是根据特定规则筛选出的股票池。系统每天动态计算符合条件的股票，形成可追溯的历史数据集。

#### 预设标签类型：
- **涨幅最大TOP20**：每个交易日涨幅最大的20只股票
- **跌幅最大TOP20**：每个交易日跌幅最大的20只股票  
- **市值涨幅最大TOP20**：市值增长最快的20只股票
- **市值跌幅最大TOP20**：市值下降最快的20只股票

### 2.2 策略说明

#### 策略1：下跌买入策略（逆向投资）
**投资逻辑**：在股票超跌时买入，等待反弹获利

**具体规则**：
- 数据源：跌幅最大TOP20标签
- 过滤条件：
  - 市值 > 1亿美金（避免小盘股）
  - 当日跌幅 < 60%（排除异常暴跌）
  - 保留5只股票（分散风险）
- 执行参数：
  - 初始资金：10万美金
  - 买入时机：T+1开盘（第二天开盘价买入）
  - 持仓天数：5天
  - 卖出时机：开盘价卖出
  - 执行频率：每7天执行一次，共执行5次

#### 策略2：上涨买入策略（动量投资）
**投资逻辑**：追踪强势股，顺势而为

**具体规则**：
- 数据源：市值涨幅TOP20标签
- 过滤条件：
  - 市值 > 5亿美金（选择大中盘股）
  - 保留5只股票
- 执行参数：
  - 初始资金：10万美金
  - 买入时机：T+1开盘
  - 持仓天数：5天
  - 卖出时机：开盘价卖出
  - 执行频率：每7天执行一次，共执行5次

## 三、操作流程详解

### 步骤1：数据准备（数据管理页）

#### 1.1 下载基础数据
**首次使用**：
1. 进入"数据管理"页面
2. 在"基础数据下载"卡片中设置数据时间范围（默认2年，可选3年或更长）
3. 点击纳斯达克/纽交所任务的"执行下载"按钮
4. 等待下载完成（进度条显示）

**日常更新**：
- 系统会显示"增量更新任务"
- 点击"更新到最新"按钮，更新到最新交易日

#### 1.2 创建和计算标签
1. 点击"➕ 创建标签"按钮
2. **弹窗填写内容**：
   - **选择标签规则**：从下拉列表选择（如"跌幅最大TOP20"）
   - **计算时间范围**：设置开始日期和结束日期（如2023-01-01至2025-01-20）
3. 点击"创建并计算"
4. 系统开始计算该时间段内每天的TOP20股票

#### 1.3 更新已有标签
- 对于已计算的标签，点击"更新计算"按钮
- 系统会将数据更新到最新日期

### 步骤2：策略选择（策略管理页）

1. 进入"策略管理"页面
2. 查看两个预设策略的详细参数
3. 点击"使用此策略"进入回测配置

### 步骤3：回测配置（回测页）

#### 3.1 当前策略确认
- 页面顶部显示当前选择的策略摘要
- 如需更换，点击"🔄 更换策略"按钮

#### 3.2 配置数据源
1. **选择标签**：
   - 下拉列表显示所有已计算的标签及其时间段
   - 选择后自动填充时间范围（只读，继承自标签）
   - 未创建的标签显示为禁用状态

#### 3.3 设置过滤规则
根据策略需要调整：
- **市值范围**：设置最小值和最大值（百万美金）
- **涨跌幅限制**：设置当日涨跌幅范围（百分比）
- **保留股票数**：最终保留的股票数量（TOP N）

#### 3.4 策略参数配置
- **初始资金**：投入的总资金
- **买入时机**：T+1开盘/T+1收盘/T+2开盘
- **持仓天数**：每次买入后的持有天数
- **卖出时机**：开盘/收盘
- **执行频率**：多少天执行一次
- **执行次数**：总共执行几次
- **仓位管理**：等权分配/市值加权

#### 3.5 执行回测
点击"⚡ 运行回测"按钮，系统开始计算

### 步骤4：结果分析

#### 4.1 关键指标解读
- **总收益率**：策略的总体盈亏百分比
- **年化收益**：折算成年度的收益率
- **最大回撤**：期间的最大亏损幅度
- **夏普比率**：风险调整后的收益指标（>1为良好）

#### 4.2 查看交易明细
- 每个执行批次的具体股票
- 买入/卖出价格
- 单次收益率

#### 4.3 保存和导出
- 点击"💾 保存为实验"：保存回测结果供后续查看
- 点击"📊 导出报告"：导出PNG格式报告

### 步骤5：深度测试（可选）

**功能说明**：对已执行的策略进行参数优化，寻找最优参数组合

1. 选择历史策略（从已保存的实验中选择）
2. **参数穷举设置**：
   - 勾选要优化的参数
   - 设置参数范围和步长
   - 如：持仓天数3-20天，步长1天
3. **优化目标**：
   - 最大化收益
   - 最小化回撤
   - 最优夏普比率
4. 设置最大测试次数（如1000次）
5. 执行优化（功能开发中）

### 步骤6：历史管理（历史实验页）

1. 使用筛选条件查找历史实验
2. 查看每个实验的关键指标
3. 操作选项：
   - **查看**：查看完整报告
   - **复跑**：使用相同参数重新执行
   - **删除**：删除实验记录

## 四、典型操作场景

### 场景1：测试逆向投资策略
1. 确保已下载2年历史数据
2. 创建"跌幅最大TOP20"标签，时间范围2023-01-01至2025-01-20
3. 等待标签计算完成
4. 进入回测页，选择"下跌买入策略"
5. 选择刚创建的标签作为数据源
6. 设置过滤：市值>100M，跌幅<60%，保留5只
7. 运行回测查看结果

### 场景2：对比不同持仓天数的影响
1. 完成一次标准回测
2. 保存为实验
3. 修改持仓天数（如改为10天）
4. 再次运行并保存
5. 在历史实验页对比两次结果

## 五、注意事项

1. **数据完整性**：确保基础数据下载完成后再创建标签
2. **时间一致性**：标签的时间范围会自动传递到回测，确保数据一致
3. **参数合理性**：
   - 执行频率应大于持仓天数（避免仓位重叠）
   - 保留股票数不应过多（建议5-10只）
   - 市值过滤避免流动性风险
4. **结果解读**：
   - 正收益不代表策略一定有效（需考虑市场整体表现）
   - 回撤过大说明风险控制不足
   - 夏普比率<1说明风险收益比不理想

## 六、常见问题

**Q1：为什么要设置T+1买入？**
A：模拟真实交易场景，收盘后选股，次日开盘买入。

**Q2：执行5次是什么意思？**
A：策略会在时间范围内执行5个批次，每批次间隔7天，用于验证策略的稳定性。

**Q3：为什么要过滤市值？**
A：小市值股票流动性差，实际交易时可能无法以预期价格成交。

**Q4：标签需要每天更新吗？**
A：不需要每天更新，只在需要最新数据时点击"更新计算"即可。