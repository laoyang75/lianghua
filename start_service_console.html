<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>é‡åŒ–å›æµ‹ç³»ç»Ÿ - æœåŠ¡æ§åˆ¶å°</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1890ff;
            text-align: center;
            margin-bottom: 30px;
        }
        .status-card {
            background: #f0f8ff;
            border: 1px solid #1890ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #40a9ff;
        }
        .log-area {
            background: #001529;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ é‡åŒ–å›æµ‹ç³»ç»ŸæœåŠ¡æ§åˆ¶å°</h1>
        
        <div class="status-card">
            <h3>ğŸ“Š æœåŠ¡çŠ¶æ€</h3>
            <p><strong>åç«¯æœåŠ¡:</strong> <span id="status">æ£€æŸ¥ä¸­...</span></p>
            <p><strong>ç«¯å£:</strong> <span id="port">5318</span></p>
            <p><strong>å‰ç«¯ç•Œé¢:</strong> <a href="http://localhost:5187" target="_blank" id="frontendLink">http://localhost:5187</a></p>
        </div>

        <div class="status-card">
            <h3>ğŸ® æœåŠ¡æ§åˆ¶</h3>
            <button class="btn" onclick="startBackend()">ğŸš€ å¯åŠ¨åç«¯æœåŠ¡</button>
            <button class="btn" onclick="checkHealth()">ğŸ¥ å¥åº·æ£€æŸ¥</button>
            <button class="btn" onclick="openFrontend()">ğŸ–¥ï¸ æ‰“å¼€å‰ç«¯ç•Œé¢</button>
        </div>

        <div class="status-card">
            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
            <div class="log-area" id="logArea">
                <div>[å¯åŠ¨] æœåŠ¡æ§åˆ¶å°å·²å‡†å¤‡å°±ç»ª</div>
                <div>[ä¿¡æ¯] ç‚¹å‡»æŒ‰é’®è¿›è¡ŒæœåŠ¡ç®¡ç†æ“ä½œ</div>
            </div>
        </div>

        <div class="status-card">
            <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li><strong>å¯åŠ¨åç«¯æœåŠ¡:</strong> ç‚¹å‡»"å¯åŠ¨åç«¯æœåŠ¡"æŒ‰é’®</li>
                <li><strong>æ£€æŸ¥çŠ¶æ€:</strong> ä½¿ç”¨"å¥åº·æ£€æŸ¥"éªŒè¯æœåŠ¡</li>
                <li><strong>è®¿é—®ç•Œé¢:</strong> ç‚¹å‡»"æ‰“å¼€å‰ç«¯ç•Œé¢"è®¿é—®Webç•Œé¢</li>
                <li><strong>æŸ¥çœ‹æ—¥å¿—:</strong> åœ¨æ“ä½œæ—¥å¿—åŒºåŸŸæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
            </ul>
        </div>
    </div>

    <script>
        // ç«¯å£é…ç½® - å¯ä»¥é€šè¿‡å¤–éƒ¨é…ç½®åŠ¨æ€åŠ è½½
        let BACKEND_PORT = 5318;
        let FRONTEND_PORT = 5187;
        
        // å°è¯•ä»é…ç½®æ–‡ä»¶åŠ è½½ç«¯å£ä¿¡æ¯
        async function loadPortConfig() {
            try {
                const response = await fetch('./ports_config.json');
                if (response.ok) {
                    const config = await response.json();
                    BACKEND_PORT = config.backend.port;
                    FRONTEND_PORT = config.frontend.port;
                    
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    document.getElementById('port').textContent = BACKEND_PORT;
                    const frontendLink = document.getElementById('frontendLink');
                    frontendLink.href = `http://localhost:${FRONTEND_PORT}`;
                    frontendLink.textContent = `http://localhost:${FRONTEND_PORT}`;
                    
                    addLog(`âœ… å·²åŠ è½½ç«¯å£é…ç½®: åç«¯${BACKEND_PORT}, å‰ç«¯${FRONTEND_PORT}`, 'success');
                }
            } catch (error) {
                addLog(`âš ï¸ æ— æ³•åŠ è½½ç«¯å£é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`, 'info');
            }
        }
        
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const time = new Date().toLocaleTimeString();
            const logLine = document.createElement('div');
            logLine.innerHTML = `[${time}] ${message}`;
            if (type === 'error') logLine.style.color = '#ff7875';
            if (type === 'success') logLine.style.color = '#52c41a';
            logArea.appendChild(logLine);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function updateStatus(status, color) {
            document.getElementById('status').innerHTML = `<span style="color: ${color}">${status}</span>`;
        }

        async function startBackend() {
            addLog('ğŸš€ æ­£åœ¨å¯åŠ¨åç«¯æœåŠ¡...');
            updateStatus('å¯åŠ¨ä¸­...', '#faad14');
            
            try {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„å¯åŠ¨é€»è¾‘
                addLog('â„¹ï¸ åç«¯å¯åŠ¨åŠŸèƒ½éœ€è¦Pythonç¯å¢ƒæ”¯æŒ', 'info');
                addLog(`ğŸ’¡ å»ºè®®æ‰‹åŠ¨è¿è¡Œ: python backend/app/main.py --port ${BACKEND_PORT}`, 'info');
            } catch (error) {
                addLog(`âŒ å¯åŠ¨å¤±è´¥: ${error.message}`, 'error');
                updateStatus('å¯åŠ¨å¤±è´¥', '#ff4d4f');
            }
        }

        async function checkHealth() {
            addLog('ğŸ” æ­£åœ¨æ£€æŸ¥åç«¯æœåŠ¡å¥åº·çŠ¶æ€...');
            
            try {
                const response = await fetch(`http://127.0.0.1:${BACKEND_PORT}/healthz`);
                if (response.ok) {
                    const data = await response.json();
                    addLog(`âœ… å¥åº·æ£€æŸ¥é€šè¿‡: ${data.status}`, 'success');
                    updateStatus('è¿è¡Œä¸­', '#52c41a');
                } else {
                    addLog(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: HTTP ${response.status}`, 'error');
                    updateStatus('å¼‚å¸¸', '#ff4d4f');
                }
            } catch (error) {
                addLog(`âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡: ${error.message}`, 'error');
                updateStatus('å·²åœæ­¢', '#d9d9d9');
            }
        }

        function openFrontend() {
            addLog('ğŸ–¥ï¸ æ­£åœ¨æ‰“å¼€å‰ç«¯ç•Œé¢...');
            window.open(`http://localhost:${FRONTEND_PORT}`, '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', async () => {
            await loadPortConfig();  // å…ˆåŠ è½½ç«¯å£é…ç½®
            setTimeout(checkHealth, 1000);
            // æ¯30ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
            setInterval(checkHealth, 30000);
        });
    </script>
</body>
</html>